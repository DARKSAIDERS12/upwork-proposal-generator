<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–¢–µ—Å—Ç –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .test-section {
            background: white;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .status {
            padding: 10px;
            margin: 10px 0;
            border-radius: 4px;
            font-weight: bold;
        }
        .success { background: #d4edda; color: #155724; }
        .error { background: #f8d7da; color: #721c24; }
        .info { background: #d1ecf1; color: #0c5460; }
        button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover { background: #0056b3; }
        input {
            padding: 8px;
            margin: 5px;
            border: 1px solid #ddd;
            border-radius: 4px;
            width: 200px;
        }
    </style>
</head>
<body>
    <h1>üß™ –¢–µ—Å—Ç –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏</h1>
    
    <div class="test-section">
        <h2>1. –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ Supabase SDK</h2>
        <div id="supabaseStatus" class="status info">–ü—Ä–æ–≤–µ—Ä—è–µ–º...</div>
        <button onclick="checkSupabase()">–ü—Ä–æ–≤–µ—Ä–∏—Ç—å Supabase</button>
    </div>
    
    <div class="test-section">
        <h2>2. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ñ—É–Ω–∫—Ü–∏–π –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏</h2>
        <div id="authFunctionsStatus" class="status info">–ü—Ä–æ–≤–µ—Ä—è–µ–º...</div>
        <button onclick="checkAuthFunctions()">–ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ñ—É–Ω–∫—Ü–∏–∏</button>
    </div>
    
    <div class="test-section">
        <h2>3. –¢–µ—Å—Ç —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏</h2>
        <input type="email" id="testEmail" placeholder="test@example.com" value="test@example.com">
        <input type="password" id="testPassword" placeholder="password123" value="password123">
        <button onclick="testRegistration()">–¢–µ—Å—Ç —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏</button>
        <div id="registrationResult"></div>
    </div>
    
    <div class="test-section">
        <h2>4. –¢–µ—Å—Ç –≤—Ö–æ–¥–∞</h2>
        <button onclick="testLogin()">–¢–µ—Å—Ç –≤—Ö–æ–¥–∞</button>
        <div id="loginResult"></div>
    </div>
    
    <div class="test-section">
        <h2>5. –¢–µ—Å—Ç –≤—ã—Ö–æ–¥–∞</h2>
        <button onclick="testLogout()">–¢–µ—Å—Ç –≤—ã—Ö–æ–¥–∞</button>
        <div id="logoutResult"></div>
    </div>
    
    <div class="test-section">
        <h2>6. –°—Ç–∞—Ç—É—Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</h2>
        <div id="userStatus" class="status info">–ù–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω</div>
        <button onclick="checkUserStatus()">–ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å</button>
    </div>

    <!-- Supabase SDK -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    
    <!-- Auth.js -->
    <script src="auth.js"></script>
    
    <script>
        // –ü—Ä–æ–≤–µ—Ä–∫–∞ Supabase SDK
        function checkSupabase() {
            const status = document.getElementById('supabaseStatus');
            if (typeof createClient !== 'undefined') {
                status.className = 'status success';
                status.textContent = '‚úÖ Supabase SDK –∑–∞–≥—Ä—É–∂–µ–Ω —É—Å–ø–µ—à–Ω–æ';
            } else {
                status.className = 'status error';
                status.textContent = '‚ùå Supabase SDK –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω';
            }
        }
        
        // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ñ—É–Ω–∫—Ü–∏–π –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏
        function checkAuthFunctions() {
            const status = document.getElementById('authFunctionsStatus');
            const functions = ['signInWithGitHub', 'registerUser', 'loginUser', 'logoutUser', 'onAuthStateChange'];
            const missing = functions.filter(f => typeof window[f] === 'undefined');
            
            if (missing.length === 0) {
                status.className = 'status success';
                status.textContent = '‚úÖ –í—Å–µ —Ñ—É–Ω–∫—Ü–∏–∏ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ –¥–æ—Å—Ç—É–ø–Ω—ã';
            } else {
                status.className = 'status error';
                status.textContent = `‚ùå –û—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç —Ñ—É–Ω–∫—Ü–∏–∏: ${missing.join(', ')}`;
            }
        }
        
        // –¢–µ—Å—Ç —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏
        async function testRegistration() {
            const result = document.getElementById('registrationResult');
            try {
                const email = document.getElementById('testEmail').value;
                const password = document.getElementById('testPassword').value;
                
                if (typeof registerUser === 'undefined') {
                    result.innerHTML = '<div class="status error">‚ùå –§—É–Ω–∫—Ü–∏—è registerUser –Ω–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∞</div>';
                    return;
                }
                
                result.innerHTML = '<div class="status info">üîÑ –†–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ–º...</div>';
                const user = await registerUser(email, password, email);
                result.innerHTML = `<div class="status success">‚úÖ –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è —É—Å–ø–µ—à–Ω–∞: ${user.email}</div>`;
                checkUserStatus();
            } catch (error) {
                result.innerHTML = `<div class="status error">‚ùå –û—à–∏–±–∫–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏: ${error.message}</div>`;
            }
        }
        
        // –¢–µ—Å—Ç –≤—Ö–æ–¥–∞
        async function testLogin() {
            const result = document.getElementById('loginResult');
            try {
                const email = document.getElementById('testEmail').value;
                const password = document.getElementById('testPassword').value;
                
                if (typeof loginUser === 'undefined') {
                    result.innerHTML = '<div class="status error">‚ùå –§—É–Ω–∫—Ü–∏—è loginUser –Ω–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∞</div>';
                    return;
                }
                
                result.innerHTML = '<div class="status info">üîÑ –í—Ö–æ–¥–∏–º...</div>';
                const user = await loginUser(email, password);
                result.innerHTML = `<div class="status success">‚úÖ –í—Ö–æ–¥ —É—Å–ø–µ—à–µ–Ω: ${user.email}</div>`;
                checkUserStatus();
            } catch (error) {
                result.innerHTML = `<div class="status error">‚ùå –û—à–∏–±–∫–∞ –≤—Ö–æ–¥–∞: ${error.message}</div>`;
            }
        }
        
        // –¢–µ—Å—Ç –≤—ã—Ö–æ–¥–∞
        async function testLogout() {
            const result = document.getElementById('logoutResult');
            try {
                if (typeof logoutUser === 'undefined') {
                    result.innerHTML = '<div class="status error">‚ùå –§—É–Ω–∫—Ü–∏—è logoutUser –Ω–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∞</div>';
                    return;
                }
                
                result.innerHTML = '<div class="status info">üîÑ –í—ã—Ö–æ–¥–∏–º...</div>';
                await logoutUser();
                result.innerHTML = '<div class="status success">‚úÖ –í—ã—Ö–æ–¥ —É—Å–ø–µ—à–µ–Ω</div>';
                checkUserStatus();
            } catch (error) {
                result.innerHTML = `<div class="status error">‚ùå –û—à–∏–±–∫–∞ –≤—ã—Ö–æ–¥–∞: ${error.message}</div>`;
            }
        }
        
        // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        async function checkUserStatus() {
            const status = document.getElementById('userStatus');
            try {
                if (typeof getCurrentUser === 'undefined') {
                    status.className = 'status error';
                    status.textContent = '‚ùå –§—É–Ω–∫—Ü–∏—è getCurrentUser –Ω–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∞';
                    return;
                }
                
                const user = await getCurrentUser();
                if (user) {
                    status.className = 'status success';
                    status.textContent = `‚úÖ –ê–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω: ${user.email}`;
                } else {
                    status.className = 'status info';
                    status.textContent = 'üë§ –ù–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω';
                }
            } catch (error) {
                status.className = 'status error';
                status.textContent = `‚ùå –û—à–∏–±–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏: ${error.message}`;
            }
        }
        
        // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        window.addEventListener('load', function() {
            setTimeout(() => {
                checkSupabase();
                setTimeout(() => {
                    checkAuthFunctions();
                    checkUserStatus();
                }, 1000);
            }, 500);
        });
        
        // –°–ª—É—à–∞—Ç–µ–ª—å —Å–æ—Å—Ç–æ—è–Ω–∏—è –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏
        if (typeof onAuthStateChange !== 'undefined') {
            onAuthStateChange((user) => {
                if (user) {
                    console.log('‚úÖ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–æ—à–µ–ª:', user.email);
                    checkUserStatus();
                } else {
                    console.log('üëã –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤—ã—à–µ–ª');
                    checkUserStatus();
                }
            });
        }
    </script>
</body>
</html>
