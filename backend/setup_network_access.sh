#!/bin/bash

echo "üîß –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Å–µ—Ç–µ–≤–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞ –∫ —Å–µ—Ä–≤–µ—Ä—É –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏..."

# –ü–æ–ª—É—á–∞–µ–º IP –∞–¥—Ä–µ—Å —Ç–µ–∫—É—â–µ–≥–æ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞
LOCAL_IP=$(hostname -I | awk '{print $1}')
echo "üìç –í–∞—à –ª–æ–∫–∞–ª—å–Ω—ã–π IP –∞–¥—Ä–µ—Å: $LOCAL_IP"

# –ü—Ä–æ–≤–µ—Ä—è–µ–º, –∑–∞–ø—É—â–µ–Ω –ª–∏ —Å–µ—Ä–≤–µ—Ä
if pgrep -f "auth_server.py" > /dev/null; then
    echo "‚úÖ –°–µ—Ä–≤–µ—Ä –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ —É–∂–µ –∑–∞–ø—É—â–µ–Ω"
else
    echo "üöÄ –ó–∞–ø—É—Å–∫–∞–µ–º —Å–µ—Ä–≤–µ—Ä –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏..."
    cd "$(dirname "$0")"
    nohup python3 auth_server.py > server.log 2>&1 &
    sleep 2
fi

# –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å—Ç–∞—Ç—É—Å —Å–µ—Ä–≤–µ—Ä–∞
echo "üîç –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å—Ç–∞—Ç—É—Å —Å–µ—Ä–≤–µ—Ä–∞..."
if curl -s "http://localhost:5000/api/health" > /dev/null; then
    echo "‚úÖ –°–µ—Ä–≤–µ—Ä —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–∞ localhost:5000"
else
    echo "‚ùå –°–µ—Ä–≤–µ—Ä –Ω–µ –æ—Ç–≤–µ—á–∞–µ—Ç –Ω–∞ localhost:5000"
    exit 1
fi

# –ü—Ä–æ–≤–µ—Ä—è–µ–º –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å –ø–æ —Å–µ—Ç–∏
echo "üåê –ü—Ä–æ–≤–µ—Ä—è–µ–º –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å –ø–æ —Å–µ—Ç–∏..."
if curl -s "http://$LOCAL_IP:5000/api/health" > /dev/null; then
    echo "‚úÖ –°–µ—Ä–≤–µ—Ä –¥–æ—Å—Ç—É–ø–µ–Ω –ø–æ —Å–µ—Ç–∏: http://$LOCAL_IP:5000"
else
    echo "‚ùå –°–µ—Ä–≤–µ—Ä –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω –ø–æ —Å–µ—Ç–∏"
    echo "üîß –í–æ–∑–º–æ–∂–Ω–æ, –Ω—É–∂–Ω–æ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å firewall..."
fi

echo ""
echo "üìã –ò–ù–°–¢–†–£–ö–¶–ò–Ø –î–õ–Ø –î–û–°–¢–£–ü–ê –° –î–†–£–ì–ò–• –£–°–¢–†–û–ô–°–¢–í:"
echo "1. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ –Ω–∞—Ö–æ–¥—è—Ç—Å—è –≤ –æ–¥–Ω–æ–π —Å–µ—Ç–∏"
echo "2. –ù–∞ –¥—Ä—É–≥–∏—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞—Ö –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ URL: http://$LOCAL_IP:5000"
echo "3. –í —Ñ–∞–π–ª–µ app.js –∏–∑–º–µ–Ω–∏—Ç–µ API_BASE_URL –Ω–∞: http://$LOCAL_IP:5000/api"
echo ""
echo "üîó –î–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –æ—Ç–∫—Ä–æ–π—Ç–µ: http://$LOCAL_IP:5000/api/health"
echo "üë• –î–ª—è –æ—Ç–ª–∞–¥–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π: http://$LOCAL_IP:5000/api/user-info/demo@example.com"
echo "üîë –î–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ —Å–µ—Å—Å–∏–π: http://$LOCAL_IP:5000/api/debug/sessions" 