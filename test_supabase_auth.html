<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Content-Security-Policy" content="default-src 'self' https: http:; script-src 'self' 'unsafe-inline' 'unsafe-eval' https: http:; style-src 'self' 'unsafe-inline' https: http:; img-src 'self' data: https: http:; font-src 'self' https: http:; connect-src 'self' https: http:;">
    <title>–¢–µ—Å—Ç Supabase –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .test-section {
            background: white;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .status {
            padding: 10px;
            margin: 10px 0;
            border-radius: 4px;
            font-weight: bold;
        }
        .success { background: #d4edda; color: #155724; }
        .error { background: #f8d7da; color: #721c24; }
        .info { background: #d1ecf1; color: #0c5460; }
        .warning { background: #fff3cd; color: #856404; }
        button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover { background: #0056b3; }
        button:disabled { background: #6c757d; cursor: not-allowed; }
        input {
            padding: 8px;
            margin: 5px;
            border: 1px solid #ddd;
            border-radius: 4px;
            width: 200px;
        }
        .log {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 4px;
            padding: 10px;
            margin: 10px 0;
            max-height: 200px;
            overflow-y: auto;
            font-family: monospace;
            font-size: 12px;
        }
        .supabase-info {
            background: #e7f3ff;
            border: 1px solid #b3d9ff;
            border-radius: 4px;
            padding: 15px;
            margin: 15px 0;
        }
    </style>
</head>
<body>
    <h1>üîê –¢–µ—Å—Ç Supabase –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏</h1>
    
    <div class="supabase-info">
        <h3>‚ÑπÔ∏è Supabase –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è</h3>
        <p>–≠—Ç–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–∞ —Ç–µ—Å—Ç–∏—Ä—É–µ—Ç –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—é —á–µ—Ä–µ–∑ Supabase</p>
        <p><strong>URL:</strong> https://xykhpnksatwipwcmxwyn.supabase.co</p>
        <p><strong>–°—Ç–∞—Ç—É—Å:</strong> <span id="supabaseStatus">–ü—Ä–æ–≤–µ—Ä—è–µ–º...</span></p>
    </div>
    
    <div class="test-section">
        <h2>1. üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ Supabase SDK</h2>
        <div id="sdkStatus" class="status info">–ü—Ä–æ–≤–µ—Ä—è–µ–º...</div>
        <button id="sdkTestBtn">–ü—Ä–æ–≤–µ—Ä–∏—Ç—å SDK</button>
        <div class="log" id="sdkLog"></div>
    </div>
    
    <div class="test-section">
        <h2>2. üîß –ü—Ä–æ–≤–µ—Ä–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏</h2>
        <div id="initStatus" class="status info">–ü—Ä–æ–≤–µ—Ä—è–µ–º...</div>
        <button id="initTestBtn">–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—é</button>
        <div class="log" id="initLog"></div>
    </div>
    
    <div class="test-section">
        <h2>3. üìù –¢–µ—Å—Ç —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏</h2>
        <input type="email" id="registerEmail" placeholder="test@example.com" value="testuser123@example.com">
        <input type="password" id="registerPassword" placeholder="password123" value="TestPassword123!">
        <button id="registerBtn">–¢–µ—Å—Ç —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏</button>
        <div id="registerResult"></div>
    </div>
    
    <div class="test-section">
        <h2>4. üîë –¢–µ—Å—Ç –≤—Ö–æ–¥–∞</h2>
        <input type="email" id="loginEmail" placeholder="test@example.com" value="testuser123@example.com">
        <input type="password" id="loginPassword" placeholder="password123" value="TestPassword123!">
        <button id="loginBtn">–¢–µ—Å—Ç –≤—Ö–æ–¥–∞</button>
        <div id="loginResult"></div>
    </div>
    
    <div class="test-section">
        <h2>5. üöÄ –ü–æ–ª–Ω–∞—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞</h2>
        <button id="fullTestBtn">–ó–∞–ø—É—Å—Ç–∏—Ç—å –ø–æ–ª–Ω—ã–π —Ç–µ—Å—Ç</button>
        <div class="log" id="fullLog"></div>
    </div>

    <!-- Supabase SDK -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    
    <!-- Auth.js -->
    <script src="auth.js"></script>
    
    <script>
        // –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
        let supabaseClient = null;
        
        // –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
        function logTo(elementId, message) {
            const element = document.getElementById('supabaseStatus');
            if (element) {
                element.textContent = message;
            }
            
            const logElement = document.getElementById(elementId);
            if (logElement) {
                const timestamp = new Date().toLocaleTimeString();
                logElement.innerHTML += `[${timestamp}] ${message}\n`;
                logElement.scrollTop = logElement.scrollHeight;
            }
        }
        
        // –ü—Ä–æ–≤–µ—Ä–∫–∞ Supabase SDK
        function testSDK() {
            const status = document.getElementById('sdkStatus');
            const log = 'sdkLog';
            
            logTo(log, 'üîç –ü—Ä–æ–≤–µ—Ä—è–µ–º Supabase SDK...');
            
            try {
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –∑–∞–≥—Ä—É–∑–∏–ª—Å—è –ª–∏ SDK
                if (typeof window.supabase !== 'undefined') {
                    status.className = 'status success';
                    status.textContent = '‚úÖ Supabase SDK –∑–∞–≥—Ä—É–∂–µ–Ω';
                    logTo(log, '‚úÖ window.supabase –¥–æ—Å—Ç—É–ø–µ–Ω');
                    return true;
                } else if (typeof createClient !== 'undefined') {
                    status.className = 'status success';
                    status.textContent = '‚úÖ Supabase SDK –∑–∞–≥—Ä—É–∂–µ–Ω';
                    logTo(log, '‚úÖ createClient –¥–æ—Å—Ç—É–ø–µ–Ω');
                    return true;
                } else {
                    status.className = 'status error';
                    status.textContent = '‚ùå Supabase SDK –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω';
                    logTo(log, '‚ùå createClient –Ω–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω');
                    logTo(log, '‚ùå window.supabase –Ω–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω');
                    return false;
                }
            } catch (error) {
                status.className = 'status error';
                status.textContent = `‚ùå –û—à–∏–±–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ SDK: ${error.message}`;
                logTo(log, `‚ùå –û—à–∏–±–∫–∞: ${error.message}`);
                return false;
            }
        }
        
        // –ü—Ä–æ–≤–µ—Ä–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏
        function testInitialization() {
            const status = document.getElementById('initStatus');
            const log = 'initLog';
            
            logTo(log, 'üîç –ü—Ä–æ–≤–µ—Ä—è–µ–º –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—é Supabase...');
            
            try {
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –¥–æ—Å—Ç—É–ø–Ω–∞ –ª–∏ —Ñ—É–Ω–∫—Ü–∏—è initSupabase
                if (typeof initSupabase !== 'undefined') {
                    logTo(log, '‚úÖ –§—É–Ω–∫—Ü–∏—è initSupabase –¥–æ—Å—Ç—É–ø–Ω–∞');
                    
                    // –ü—ã—Ç–∞–µ–º—Å—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å Supabase
                    try {
                        initSupabase();
                        logTo(log, '‚úÖ initSupabase() –≤—ã–∑–≤–∞–Ω–∞');
                        
                        // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —Å–æ–∑–¥–∞–ª—Å—è –ª–∏ –∫–ª–∏–µ–Ω—Ç
                        if (typeof supabase !== 'undefined' && supabase !== null) {
                            supabaseClient = supabase;
                            status.className = 'status success';
                            status.textContent = '‚úÖ Supabase –ø–æ–ª–Ω–æ—Å—Ç—å—é –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω';
                            logTo(log, '‚úÖ Supabase –∫–ª–∏–µ–Ω—Ç —Å–æ–∑–¥–∞–Ω');
                            return true;
                        } else {
                            // –ü–æ–ø—Ä–æ–±—É–µ–º —Å–æ–∑–¥–∞—Ç—å –∫–ª–∏–µ–Ω—Ç –Ω–∞–ø—Ä—è–º—É—é
                            try {
                                const supabaseUrl = 'https://xykhpnksatwipwcmxwyn.supabase.co';
                                const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Inh5a2hwbmtzYXR3aXB3Y214d3luIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTUyNTAyNjIsImV4cCI6MjA3MDgyNjI2Mn0.PSARsuv14dI7xq35xvgVoxwjptb4cm8Ywb3bYZhY0KM';
                                supabaseClient = window.supabase.createClient(supabaseUrl, supabaseKey);
                                status.className = 'status success';
                                status.textContent = '‚úÖ Supabase –∫–ª–∏–µ–Ω—Ç —Å–æ–∑–¥–∞–Ω –Ω–∞–ø—Ä—è–º—É—é';
                                logTo(log, '‚úÖ Supabase –∫–ª–∏–µ–Ω—Ç —Å–æ–∑–¥–∞–Ω –Ω–∞–ø—Ä—è–º—É—é');
                                return true;
                            } catch (directError) {
                                status.className = 'status warning';
                                status.textContent = '‚ö†Ô∏è Supabase –Ω–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω';
                                logTo(log, `‚ö†Ô∏è Supabase –∫–ª–∏–µ–Ω—Ç –Ω–µ —Å–æ–∑–¥–∞–Ω: ${directError.message}`);
                                return false;
                            }
                        }
                    } catch (initError) {
                        logTo(log, `‚ö†Ô∏è –û—à–∏–±–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏: ${initError.message}`);
                        status.className = 'status warning';
                        status.textContent = '‚ö†Ô∏è –û—à–∏–±–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏';
                        return false;
                    }
                } else {
                    status.className = 'status error';
                    status.textContent = '‚ùå –§—É–Ω–∫—Ü–∏—è initSupabase –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞';
                    logTo(log, '‚ùå –§—É–Ω–∫—Ü–∏—è initSupabase –Ω–µ –Ω–∞–π–¥–µ–Ω–∞');
                    return false;
                }
            } catch (error) {
                status.className = 'status error';
                status.textContent = `‚ùå –û—à–∏–±–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏: ${error.message}`;
                logTo(log, `‚ùå –û—à–∏–±–∫–∞: ${error.message}`);
                return false;
            }
        }
        
        // –¢–µ—Å—Ç —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏
        async function testRegistration() {
            const result = document.getElementById('registerResult');
            const btn = document.getElementById('registerBtn');
            
            try {
                btn.disabled = true;
                const email = document.getElementById('registerEmail').value;
                const password = document.getElementById('registerPassword').value;
                
                logTo('fullLog', `üîÑ –†–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è: ${email}`);
                
                if (!supabaseClient) {
                    throw new Error('Supabase –Ω–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω');
                }
                
                // –ü—Ä—è–º–æ–π –≤—ã–∑–æ–≤ Supabase API
                const { data, error } = await supabaseClient.auth.signUp({
                    email: email,
                    password: password
                });
                
                if (error) {
                    throw new Error(error.message);
                }
                
                if (data.user) {
                    result.innerHTML = `<div class="status success">‚úÖ –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è —É—Å–ø–µ—à–Ω–∞: ${data.user.email}</div>`;
                    logTo('fullLog', `‚úÖ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω: ${data.user.email}`);
                } else {
                    result.innerHTML = `<div class="status warning">‚ö†Ô∏è –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞ –Ω–∞ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ email</div>`;
                    logTo('fullLog', '‚ö†Ô∏è –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞ –Ω–∞ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ email');
                }
                
            } catch (error) {
                result.innerHTML = `<div class="status error">‚ùå –û—à–∏–±–∫–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏: ${error.message}</div>`;
                logTo('fullLog', `‚ùå –û—à–∏–±–∫–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏: ${error.message}`);
            } finally {
                btn.disabled = false;
            }
        }
        
        // –¢–µ—Å—Ç –≤—Ö–æ–¥–∞
        async function testLogin() {
            const result = document.getElementById('loginResult');
            const btn = document.getElementById('loginBtn');
            
            try {
                btn.disabled = true;
                const email = document.getElementById('loginEmail').value;
                const password = document.getElementById('loginPassword').value;
                
                logTo('fullLog', `üîÑ –í—Ö–æ–¥–∏–º –≤ —Å–∏—Å—Ç–µ–º—É: ${email}`);
                
                if (!supabaseClient) {
                    throw new Error('Supabase –Ω–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω');
                }
                
                // –ü—Ä—è–º–æ–π –≤—ã–∑–æ–≤ Supabase API
                const { data, error } = await supabaseClient.auth.signInWithPassword({
                    email: email,
                    password: password
                });
                
                if (error) {
                    throw new Error(error.message);
                }
                
                if (data.user) {
                    result.innerHTML = `<div class="status success">‚úÖ –í—Ö–æ–¥ —É—Å–ø–µ—à–µ–Ω: ${data.user.email}</div>`;
                    logTo('fullLog', `‚úÖ –í—Ö–æ–¥ –≤—ã–ø–æ–ª–Ω–µ–Ω: ${data.user.email}`);
                } else {
                    result.innerHTML = `<div class="status warning">‚ö†Ô∏è –í—Ö–æ–¥ –Ω–µ –≤—ã–ø–æ–ª–Ω–µ–Ω</div>`;
                    logTo('fullLog', '‚ö†Ô∏è –í—Ö–æ–¥ –Ω–µ –≤—ã–ø–æ–ª–Ω–µ–Ω');
                }
                
            } catch (error) {
                result.innerHTML = `<div class="status error">‚ùå –û—à–∏–±–∫–∞ –≤—Ö–æ–¥–∞: ${error.message}</div>`;
                logTo('fullLog', `‚ùå –û—à–∏–±–∫–∞ –≤—Ö–æ–¥–∞: ${error.message}`);
            } finally {
                btn.disabled = false;
            }
        }
        
        // –ü–æ–ª–Ω–∞—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞
        async function runFullTest() {
            const log = 'fullLog';
            logTo(log, 'üöÄ –ó–∞–ø—É—Å–∫ –ø–æ–ª–Ω–æ–π –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏ Supabase...');
            
            try {
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º SDK
                const sdkOk = testSDK();
                if (!sdkOk) {
                    logTo(log, '‚ùå SDK –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω, –æ—Å—Ç–∞–ª—å–Ω—ã–µ —Ç–µ—Å—Ç—ã –ø—Ä–æ–ø—É—â–µ–Ω—ã');
                    return;
                }
                
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—é
                const initOk = testInitialization();
                if (!initOk) {
                    logTo(log, '‚ùå Supabase –Ω–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω, —Ç–µ—Å—Ç—ã –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ –ø—Ä–æ–ø—É—â–µ–Ω—ã');
                    return;
                }
                
                // –¢–µ—Å—Ç–∏—Ä—É–µ–º —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—é
                await testRegistration();
                
                // –¢–µ—Å—Ç–∏—Ä—É–µ–º –≤—Ö–æ–¥
                await testLogin();
                
                logTo(log, 'üéâ –í—Å–µ —Ç–µ—Å—Ç—ã –ø—Ä–æ–π–¥–µ–Ω—ã —É—Å–ø–µ—à–Ω–æ!');
                
            } catch (error) {
                logTo(log, `‚ùå –û—à–∏–±–∫–∞ –≤ –ø–æ–ª–Ω–æ–º —Ç–µ—Å—Ç–µ: ${error.message}`);
            }
        }
        
        // –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤ —Å–æ–±—ã—Ç–∏–π
        function setupEventListeners() {
            const sdkBtn = document.getElementById('sdkTestBtn');
            const initBtn = document.getElementById('initTestBtn');
            const registerBtn = document.getElementById('registerBtn');
            const loginBtn = document.getElementById('loginBtn');
            const fullBtn = document.getElementById('fullTestBtn');
            
            if (sdkBtn) sdkBtn.addEventListener('click', testSDK);
            if (initBtn) initBtn.addEventListener('click', testInitialization);
            if (registerBtn) registerBtn.addEventListener('click', testRegistration);
            if (loginBtn) loginBtn.addEventListener('click', testLogin);
            if (fullBtn) fullBtn.addEventListener('click', runFullTest);
        }
        
        // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        window.addEventListener('load', function() {
            setupEventListeners();
            setTimeout(() => {
                testSDK();
                setTimeout(() => {
                    testInitialization();
                }, 500);
            }, 1000);
        });
    </script>
</body>
</html>
