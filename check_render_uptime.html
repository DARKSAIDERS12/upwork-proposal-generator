<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ Render.com</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; background: #f5f5f5; }
        .container { max-width: 800px; margin: 0 auto; background: white; padding: 20px; border-radius: 10px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        .status { padding: 15px; margin: 10px 0; border-radius: 5px; }
        .success { background: #d4edda; border: 1px solid #c3e6cb; color: #155724; }
        .warning { background: #fff3cd; border: 1px solid #ffeaa7; color: #856404; }
        .error { background: #f8d7da; border: 1px solid #f5c6cb; color: #721c24; }
        .info { background: #d1ecf1; border: 1px solid #bee5eb; color: #0c5460; }
        button { padding: 10px 20px; margin: 5px; border: none; background: #007bff; color: white; border-radius: 5px; cursor: pointer; }
        button:hover { background: #0056b3; }
        .log { background: #f8f9fa; border: 1px solid #dee2e6; padding: 10px; margin: 10px 0; font-family: monospace; white-space: pre-wrap; max-height: 300px; overflow-y: auto; font-size: 12px; }
        .metric { display: inline-block; margin: 10px; padding: 10px; background: #e9ecef; border-radius: 5px; text-align: center; min-width: 120px; }
        .metric-value { font-size: 24px; font-weight: bold; color: #007bff; }
        .metric-label { font-size: 12px; color: #6c757d; }
    </style>
</head>
<body>
    <div class="container">
        <h1>üîç –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –ø—Ä–æ–±–ª–µ–º Render.com</h1>
        
        <div class="status info">
            <h3>üìä –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç–∏ —Å–µ—Ä–≤–µ—Ä–∞</h3>
            <p>–≠—Ç–∞ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –ø–æ–º–æ–∂–µ—Ç –ø–æ–Ω—è—Ç—å, —Å–≤—è–∑–∞–Ω—ã –ª–∏ –ø—Ä–æ–±–ª–µ–º—ã –≤—Ö–æ–¥–∞ —Å –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è–º–∏ –±–µ—Å–ø–ª–∞—Ç–Ω–æ–π –≤–µ—Ä—Å–∏–∏ Render.com</p>
        </div>

        <button onclick="checkServerMetrics()">üîç –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –º–µ—Ç—Ä–∏–∫–∏ —Å–µ—Ä–≤–µ—Ä–∞</button>
        <button onclick="testDatabasePersistence()">üíæ –¢–µ—Å—Ç —Å–æ—Ö—Ä–∞–Ω–Ω–æ—Å—Ç–∏ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö</button>
        <button onclick="monitorResponseTimes()">‚è±Ô∏è –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –≤—Ä–µ–º–µ–Ω–∏ –æ—Ç–≤–µ—Ç–∞</button>
        <button onclick="clearLogs()">üßπ –û—á–∏—Å—Ç–∏—Ç—å –ª–æ–≥–∏</button>

        <div id="metrics" style="margin: 20px 0;"></div>
        <div id="results"></div>
        <div id="logs" class="log"></div>
    </div>

    <script>
        const API_BASE_URL = 'https://upwork-auth-server.onrender.com/api';
        let startTime = Date.now();
        
        function log(message) {
            const timestamp = new Date().toLocaleTimeString();
            const logsDiv = document.getElementById('logs');
            logsDiv.textContent += `[${timestamp}] ${message}\n`;
            logsDiv.scrollTop = logsDiv.scrollHeight;
            console.log(message);
        }

        function showResult(message, type) {
            const resultsDiv = document.getElementById('results');
            const resultDiv = document.createElement('div');
            resultDiv.className = `status ${type}`;
            resultDiv.innerHTML = message;
            resultsDiv.appendChild(resultDiv);
        }

        function clearLogs() {
            document.getElementById('logs').textContent = '';
            document.getElementById('results').innerHTML = '';
            document.getElementById('metrics').innerHTML = '';
        }

        function updateMetrics(responseTime, userCount, dbStatus) {
            const metricsDiv = document.getElementById('metrics');
            metricsDiv.innerHTML = `
                <div class="metric">
                    <div class="metric-value">${responseTime}ms</div>
                    <div class="metric-label">–í—Ä–µ–º—è –æ—Ç–≤–µ—Ç–∞</div>
                </div>
                <div class="metric">
                    <div class="metric-value">${userCount}</div>
                    <div class="metric-label">–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –≤ –ë–î</div>
                </div>
                <div class="metric">
                    <div class="metric-value">${dbStatus}</div>
                    <div class="metric-label">–°—Ç–∞—Ç—É—Å –ë–î</div>
                </div>
            `;
        }

        async function checkServerMetrics() {
            log('üîç –ù–∞—á–∏–Ω–∞–µ–º –ø—Ä–æ–≤–µ—Ä–∫—É –º–µ—Ç—Ä–∏–∫ —Å–µ—Ä–≤–µ—Ä–∞...');
            
            try {
                const startTime = Date.now();
                const response = await fetch(`${API_BASE_URL}/health`);
                const responseTime = Date.now() - startTime;
                
                if (response.ok) {
                    const data = await response.json();
                    updateMetrics(responseTime, data.user_count, data.database);
                    
                    log(`‚úÖ –°–µ—Ä–≤–µ—Ä –æ—Ç–≤–µ—á–∞–µ—Ç –∑–∞ ${responseTime}ms`);
                    log(`üë• –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –≤ –±–∞–∑–µ: ${data.user_count}`);
                    log(`üíæ –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö: ${data.database}`);
                    log(`üïê –í—Ä–µ–º—è —Å–µ—Ä–≤–µ—Ä–∞: ${data.timestamp}`);
                    
                    // –ê–Ω–∞–ª–∏–∑ –≤—Ä–µ–º–µ–Ω–∏ –æ—Ç–≤–µ—Ç–∞
                    if (responseTime > 10000) {
                        showResult(`
                            <h4>‚ö†Ô∏è –û–ë–ù–ê–†–£–ñ–ï–ù–ê –ü–†–û–ë–õ–ï–ú–ê: –ú–µ–¥–ª–µ–Ω–Ω—ã–π –æ—Ç–≤–µ—Ç —Å–µ—Ä–≤–µ—Ä–∞</h4>
                            <p><strong>–í—Ä–µ–º—è –æ—Ç–≤–µ—Ç–∞: ${responseTime}ms (${(responseTime/1000).toFixed(1)}—Å)</strong></p>
                            <p>üîç <strong>–î–∏–∞–≥–Ω–æ–∑:</strong> –°–µ—Ä–≤–µ—Ä "–ø—Ä–æ—Å–Ω—É–ª—Å—è" - –±—ã–ª –≤ —Ä–µ–∂–∏–º–µ —Å–Ω–∞</p>
                            <p>üí° <strong>–ü—Ä–∏—á–∏–Ω–∞ –ø—Ä–æ–±–ª–µ–º –≤—Ö–æ–¥–∞:</strong> Render.com –∑–∞—Å—ã–ø–∞–µ—Ç —á–µ—Ä–µ–∑ 15 –º–∏–Ω—É—Ç –±–µ–∑–¥–µ–π—Å—Ç–≤–∏—è</p>
                            <p>üõ†Ô∏è <strong>–†–µ—à–µ–Ω–∏–µ:</strong> –ü–æ–¥–æ–∂–¥–∞—Ç—å –ø–æ–ª–Ω–æ–≥–æ "–ø—Ä–æ–±—É–∂–¥–µ–Ω–∏—è" –∏–ª–∏ –ø–µ—Ä–µ–π—Ç–∏ –Ω–∞ –ø–ª–∞—Ç–Ω—ã–π –ø–ª–∞–Ω</p>
                        `, 'warning');
                    } else if (responseTime > 3000) {
                        showResult(`
                            <h4>‚ö†Ô∏è –°–µ—Ä–≤–µ—Ä –º–µ–¥–ª–µ–Ω–Ω–æ –æ—Ç–≤–µ—á–∞–µ—Ç</h4>
                            <p>–í—Ä–µ–º—è –æ—Ç–≤–µ—Ç–∞: ${responseTime}ms - –≤–æ–∑–º–æ–∂–Ω–æ, —Å–µ—Ä–≤–µ—Ä —Ç–æ–ª—å–∫–æ —á—Ç–æ –ø—Ä–æ—Å–Ω—É–ª—Å—è</p>
                        `, 'warning');
                    } else {
                        showResult(`
                            <h4>‚úÖ –°–µ—Ä–≤–µ—Ä —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–æ—Ä–º–∞–ª—å–Ω–æ</h4>
                            <p>–í—Ä–µ–º—è –æ—Ç–≤–µ—Ç–∞: ${responseTime}ms - —Ö–æ—Ä–æ—à–∞—è —Å–∫–æ—Ä–æ—Å—Ç—å</p>
                        `, 'success');
                    }
                    
                    // –ê–Ω–∞–ª–∏–∑ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
                    if (data.user_count < 3) {
                        showResult(`
                            <h4>‚ö†Ô∏è –í–û–ó–ú–û–ñ–ù–ê–Ø –ü–†–ò–ß–ò–ù–ê –ü–†–û–ë–õ–ï–ú: –ú–∞–ª–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π</h4>
                            <p><strong>–í –±–∞–∑–µ —Ç–æ–ª—å–∫–æ ${data.user_count} –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π</strong></p>
                            <p>üîç <strong>–í–æ–∑–º–æ–∂–Ω–æ:</strong> –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –±—ã–ª–∞ –ø–µ—Ä–µ—Å–æ–∑–¥–∞–Ω–∞</p>
                            <p>üí° <strong>–†–µ—à–µ–Ω–∏–µ:</strong> –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–π—Ç–µ—Å—å –∑–∞–Ω–æ–≤–æ</p>
                        `, 'warning');
                    }
                    
                } else {
                    log(`‚ùå –û—à–∏–±–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞: ${response.status}`);
                    showResult(`‚ùå –°–µ—Ä–≤–µ—Ä –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω (–∫–æ–¥: ${response.status})`, 'error');
                }
            } catch (error) {
                log(`‚ùå –°–µ—Ç–µ–≤–∞—è –æ—à–∏–±–∫–∞: ${error.message}`);
                showResult(`‚ùå –°–µ—Ç–µ–≤–∞—è –æ—à–∏–±–∫–∞: ${error.message}`, 'error');
            }
        }

        async function testDatabasePersistence() {
            log('üíæ –¢–µ—Å—Ç–∏—Ä—É–µ–º —Å–æ—Ö—Ä–∞–Ω–Ω–æ—Å—Ç—å –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö...');
            
            const testEmail = `persistence-test-${Date.now()}@example.com`;
            const testPassword = 'testpass123';
            
            try {
                // 1. –°–æ–∑–¥–∞–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
                log(`1Ô∏è‚É£ –°–æ–∑–¥–∞–µ–º —Ç–µ—Å—Ç–æ–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è: ${testEmail}`);
                const regResponse = await fetch(`${API_BASE_URL}/register`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ email: testEmail, password: testPassword })
                });
                
                if (regResponse.ok) {
                    const regData = await regResponse.json();
                    log(`‚úÖ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å–æ–∑–¥–∞–Ω, ID: ${regData.user.id}`);
                    
                    // 2. –ñ–¥–µ–º 5 —Å–µ–∫—É–Ω–¥
                    log(`2Ô∏è‚É£ –ñ–¥–µ–º 5 —Å–µ–∫—É–Ω–¥...`);
                    await new Promise(resolve => setTimeout(resolve, 5000));
                    
                    // 3. –ü—Ä–æ–≤–µ—Ä—è–µ–º, —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å
                    log(`3Ô∏è‚É£ –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å–æ—Ö—Ä–∞–Ω–Ω–æ—Å—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è...`);
                    const loginResponse = await fetch(`${API_BASE_URL}/login`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ email: testEmail, password: testPassword })
                    });
                    
                    if (loginResponse.ok) {
                        log(`‚úÖ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∞–π–¥–µ–Ω - –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö —Å—Ç–∞–±–∏–ª—å–Ω–∞`);
                        showResult(`
                            <h4>‚úÖ –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö —Ä–∞–±–æ—Ç–∞–µ—Ç —Å—Ç–∞–±–∏–ª—å–Ω–æ</h4>
                            <p>–¢–µ—Å—Ç–æ–≤—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —É—Å–ø–µ—à–Ω–æ —Å–æ—Ö—Ä–∞–Ω–∏–ª—Å—è –∏ –Ω–∞–π–¥–µ–Ω</p>
                            <p>–ü—Ä–æ–±–ª–µ–º—ã –≤—Ö–æ–¥–∞ –ù–ï —Å–≤—è–∑–∞–Ω—ã —Å –ø–µ—Ä–µ—Å–æ–∑–¥–∞–Ω–∏–µ–º –±–∞–∑—ã</p>
                        `, 'success');
                    } else {
                        log(`‚ùå –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –Ω–∞–π–¥–µ–Ω - –≤–æ–∑–º–æ–∂–Ω–∞ –ø—Ä–æ–±–ª–µ–º–∞ —Å –±–∞–∑–æ–π`);
                        showResult(`
                            <h4>‚ö†Ô∏è –ü–†–û–ë–õ–ï–ú–ê: –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –Ω–µ—Å—Ç–∞–±–∏–ª—å–Ω–∞</h4>
                            <p>–°–æ–∑–¥–∞–Ω–Ω—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∏—Å—á–µ–∑ –∑–∞ 5 —Å–µ–∫—É–Ω–¥!</p>
                            <p><strong>–ü—Ä–∏—á–∏–Ω–∞ –ø—Ä–æ–±–ª–µ–º –≤—Ö–æ–¥–∞:</strong> Render.com –ø–µ—Ä–µ—Å–æ–∑–¥–∞–µ—Ç –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö</p>
                        `, 'error');
                    }
                } else {
                    log(`‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å —Å–æ–∑–¥–∞—Ç—å —Ç–µ—Å—Ç–æ–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è`);
                }
                
            } catch (error) {
                log(`‚ùå –û—à–∏–±–∫–∞ —Ç–µ—Å—Ç–∞: ${error.message}`);
                showResult(`‚ùå –û—à–∏–±–∫–∞ —Ç–µ—Å—Ç–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö: ${error.message}`, 'error');
            }
        }

        async function monitorResponseTimes() {
            log('‚è±Ô∏è –ù–∞—á–∏–Ω–∞–µ–º –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –≤—Ä–µ–º–µ–Ω–∏ –æ—Ç–≤–µ—Ç–∞...');
            showResult(`
                <h4>‚è±Ô∏è –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∑–∞–ø—É—â–µ–Ω</h4>
                <p>–í—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è 10 –∑–∞–ø—Ä–æ—Å–æ–≤ —Å –∏–Ω—Ç–µ—Ä–≤–∞–ª–æ–º 2 —Å–µ–∫—É–Ω–¥—ã...</p>
            `, 'info');
            
            const times = [];
            
            for (let i = 1; i <= 10; i++) {
                try {
                    const start = Date.now();
                    const response = await fetch(`${API_BASE_URL}/health`);
                    const time = Date.now() - start;
                    times.push(time);
                    
                    log(`${i}/10: ${time}ms`);
                    
                    if (i < 10) {
                        await new Promise(resolve => setTimeout(resolve, 2000));
                    }
                } catch (error) {
                    log(`${i}/10: –û—à–∏–±–∫–∞ - ${error.message}`);
                    times.push(999999);
                }
            }
            
            const avgTime = times.reduce((a, b) => a + b, 0) / times.length;
            const minTime = Math.min(...times);
            const maxTime = Math.max(...times);
            
            log(`üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞: –ú–∏–Ω=${minTime}ms, –ú–∞–∫—Å=${maxTime}ms, –°—Ä–µ–¥–Ω–µ–µ=${avgTime.toFixed(0)}ms`);
            
            if (maxTime > 15000) {
                showResult(`
                    <h4>‚ö†Ô∏è –û–ë–ù–ê–†–£–ñ–ï–ù–ê –ü–†–û–ë–õ–ï–ú–ê: –ù–µ—Å—Ç–∞–±–∏–ª—å–Ω–æ–µ –≤—Ä–µ–º—è –æ—Ç–≤–µ—Ç–∞</h4>
                    <p><strong>–ú–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –≤—Ä–µ–º—è:</strong> ${maxTime}ms (${(maxTime/1000).toFixed(1)}—Å)</p>
                    <p><strong>–°—Ä–µ–¥–Ω–µ–µ –≤—Ä–µ–º—è:</strong> ${avgTime.toFixed(0)}ms</p>
                    <p>üîç <strong>–î–∏–∞–≥–Ω–æ–∑:</strong> –°–µ—Ä–≤–µ—Ä –ø–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∏ "–∑–∞—Å—ã–ø–∞–µ—Ç"</p>
                    <p>üí° <strong>–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:</strong> –ü–µ—Ä–µ—Ö–æ–¥ –Ω–∞ –ø–ª–∞—Ç–Ω—ã–π –ø–ª–∞–Ω Render.com</p>
                `, 'warning');
            } else {
                showResult(`
                    <h4>‚úÖ –í—Ä–µ–º—è –æ—Ç–≤–µ—Ç–∞ —Å—Ç–∞–±–∏–ª—å–Ω–æ–µ</h4>
                    <p>–°—Ä–µ–¥–Ω–µ–µ –≤—Ä–µ–º—è: ${avgTime.toFixed(0)}ms</p>
                    <p>–°–µ—Ä–≤–µ—Ä —Ä–∞–±–æ—Ç–∞–µ—Ç –±–µ–∑ –ø—Ä–æ–±–ª–µ–º</p>
                `, 'success');
            }
        }

        // –ê–≤—Ç–æ–∑–∞–ø—É—Å–∫
        window.addEventListener('load', () => {
            log('üöÄ –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ Render.com –∑–∞–≥—Ä—É–∂–µ–Ω–∞');
            log('üí° –ù–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫–∏ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ä–∞–∑–ª–∏—á–Ω—ã—Ö –∞—Å–ø–µ–∫—Ç–æ–≤ —Å–µ—Ä–≤–µ—Ä–∞');
        });
    </script>
</body>
</html>

