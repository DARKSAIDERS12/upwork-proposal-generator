<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–¥–ø–∏—Å–∫–æ–π - Upwork Proposal Generator</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <style>
        .gradient-bg {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        .subscription-card {
            transition: all 0.3s ease;
        }
        .subscription-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
        }
        .status-active {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
        }
        .status-expired {
            background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
        }
    </style>
</head>
<body class="bg-gray-50 min-h-screen">
    <!-- –ù–∞–≤–∏–≥–∞—Ü–∏—è -->
    <nav class="bg-white shadow-lg">
        <div class="container mx-auto px-4">
            <div class="flex justify-between items-center py-4">
                <div class="flex items-center">
                    <a href="index.html" class="text-2xl font-bold text-blue-600">üöÄ Upwork Proposals</a>
                </div>
                <div class="flex items-center space-x-4">
                    <a href="index.html" class="text-gray-600 hover:text-blue-600 transition duration-200">‚Üê –ù–∞–∑–∞–¥ –∫ –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä—É</a>
                    <div id="userInfo" class="hidden">
                        <span id="userEmail" class="text-gray-700 font-medium"></span>
                        <button onclick="logout()" class="ml-4 bg-red-600 hover:bg-red-700 text-white px-4 py-2 rounded-lg transition duration-200">
                            –í—ã–π—Ç–∏
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </nav>

    <div class="container mx-auto px-4 py-8">
        <!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ -->
        <div class="text-center mb-8">
            <h1 class="text-4xl font-bold text-gray-800 mb-2">‚öôÔ∏è –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–¥–ø–∏—Å–∫–æ–π</h1>
            <p class="text-xl text-gray-600">–ö–æ–Ω—Ç—Ä–æ–ª–∏—Ä—É–π—Ç–µ —Å–≤–æ–π —Ç–∞—Ä–∏—Ñ–Ω—ã–π –ø–ª–∞–Ω –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏</p>
        </div>

        <!-- –¢–µ–∫—É—â–∞—è –ø–æ–¥–ø–∏—Å–∫–∞ -->
        <div id="currentSubscription" class="max-w-4xl mx-auto mb-8">
            <!-- –ó–∞–≥—Ä—É–∑–∫–∞... -->
        </div>

        <!-- –ò—Å—Ç–æ—Ä–∏—è –ø–ª–∞—Ç–µ–∂–µ–π -->
        <div id="paymentHistory" class="max-w-4xl mx-auto mb-8">
            <!-- –ó–∞–≥—Ä—É–∑–∫–∞... -->
        </div>

        <!-- –î–µ–π—Å—Ç–≤–∏—è —Å –ø–æ–¥–ø–∏—Å–∫–æ–π -->
        <div id="subscriptionActions" class="max-w-4xl mx-auto mb-8">
            <!-- –ó–∞–≥—Ä—É–∑–∫–∞... -->
        </div>

        <!-- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Ç–∞—Ä–∏—Ñ–∞—Ö -->
        <div class="max-w-6xl mx-auto">
            <h2 class="text-3xl font-bold text-gray-800 text-center mb-8">üìä –°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Ç–∞—Ä–∏—Ñ–æ–≤</h2>
            <div class="grid md:grid-cols-4 gap-6">
                <!-- –ë–µ—Å–ø–ª–∞—Ç–Ω—ã–π –ø–ª–∞–Ω -->
                <div class="bg-white rounded-lg shadow-md p-6 subscription-card">
                    <div class="text-center mb-4">
                        <h3 class="text-xl font-semibold text-gray-600">–ë–µ—Å–ø–ª–∞—Ç–Ω—ã–π</h3>
                        <div class="text-3xl font-bold text-gray-800">0 ‚ÇΩ</div>
                        <div class="text-gray-600">–Ω–∞–≤—Å–µ–≥–¥–∞</div>
                    </div>
                    <ul class="space-y-3 mb-6">
                        <li class="flex items-center">
                            <span class="text-green-500 mr-2">‚úÖ</span>
                            3 –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è/–¥–µ–Ω—å
                        </li>
                        <li class="flex items-center">
                            <span class="text-green-500 mr-2">‚úÖ</span>
                            –î–µ–º–æ AI
                        </li>
                        <li class="flex items-center">
                            <span class="text-green-500 mr-2">‚úÖ</span>
                            –ë–∞–∑–æ–≤—ã–µ —à–∞–±–ª–æ–Ω—ã
                        </li>
                        <li class="flex items-center text-gray-400">
                            <span class="mr-2">‚ùå</span>
                            –≠–∫—Å–ø–æ—Ä—Ç
                        </li>
                        <li class="flex items-center text-gray-400">
                            <span class="mr-2">‚ùå</span>
                            –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç–Ω–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞
                        </li>
                    </ul>
                </div>

                <!-- Premium –ø–ª–∞–Ω -->
                <div class="bg-white rounded-lg shadow-md p-6 subscription-card border-2 border-blue-200">
                    <div class="text-center mb-4">
                        <h3 class="text-xl font-semibold text-blue-600">Premium</h3>
                        <div class="text-3xl font-bold text-blue-600">1,500 ‚ÇΩ</div>
                        <div class="text-blue-600">–≤ –º–µ—Å—è—Ü</div>
                    </div>
                    <ul class="space-y-3 mb-6">
                        <li class="flex items-center">
                            <span class="text-green-500 mr-2">‚úÖ</span>
                            50 –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–π/–¥–µ–Ω—å
                        </li>
                        <li class="flex items-center">
                            <span class="text-green-500 mr-2">‚úÖ</span>
                            Yandex GPT
                        </li>
                        <li class="flex items-center">
                            <span class="text-green-500 mr-2">‚úÖ</span>
                            –ü—Ä–µ–º–∏—É–º —à–∞–±–ª–æ–Ω—ã
                        </li>
                        <li class="flex items-center">
                            <span class="text-green-500 mr-2">‚úÖ</span>
                            –≠–∫—Å–ø–æ—Ä—Ç
                        </li>
                        <li class="flex items-center">
                            <span class="text-green-500 mr-2">‚úÖ</span>
                            –ü–æ–¥–¥–µ—Ä–∂–∫–∞
                        </li>
                    </ul>
                </div>

                <!-- Pro –ø–ª–∞–Ω -->
                <div class="bg-white rounded-lg shadow-md p-6 subscription-card border-2 border-purple-200">
                    <div class="text-center mb-4">
                        <h3 class="text-xl font-semibold text-purple-600">Pro</h3>
                        <div class="text-3xl font-bold text-purple-600">3,000 ‚ÇΩ</div>
                        <div class="text-purple-600">–≤ –º–µ—Å—è—Ü</div>
                    </div>
                    <ul class="space-y-3 mb-6">
                        <li class="flex items-center">
                            <span class="text-green-500 mr-2">‚úÖ</span>
                            200 –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–π/–¥–µ–Ω—å
                        </li>
                        <li class="flex items-center">
                            <span class="text-green-500 mr-2">‚úÖ</span>
                            Yandex GPT + GigaChat
                        </li>
                        <li class="flex items-center">
                            <span class="text-green-500 mr-2">‚úÖ</span>
                            –í—Å–µ —à–∞–±–ª–æ–Ω—ã
                        </li>
                        <li class="flex items-center">
                            <span class="text-green-500 mr-2">‚úÖ</span>
                            –ê–Ω–∞–ª–∏—Ç–∏–∫–∞
                        </li>
                        <li class="flex items-center">
                            <span class="text-green-500 mr-2">‚úÖ</span>
                            –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç–Ω–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞
                        </li>
                    </ul>
                </div>

                <!-- Enterprise –ø–ª–∞–Ω -->
                <div class="bg-white rounded-lg shadow-md p-6 subscription-card border-2 border-green-200">
                    <div class="text-center mb-4">
                        <h3 class="text-xl font-semibold text-green-600">Enterprise</h3>
                        <div class="text-3xl font-bold text-green-600">9,900 ‚ÇΩ</div>
                        <div class="text-green-600">–≤ –º–µ—Å—è—Ü</div>
                    </div>
                    <ul class="space-y-3 mb-6">
                        <li class="flex items-center">
                            <span class="text-green-500 mr-2">‚úÖ</span>
                            –ë–µ–∑–ª–∏–º–∏—Ç–Ω—ã–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è
                        </li>
                        <li class="flex items-center">
                            <span class="text-green-500 mr-2">‚úÖ</span>
                            –í—Å–µ AI –ø—Ä–æ–≤–∞–π–¥–µ—Ä—ã
                        </li>
                        <li class="flex items-center">
                            <span class="text-green-500 mr-2">‚úÖ</span>
                            API –¥–æ—Å—Ç—É–ø
                        </li>
                        <li class="flex items-center">
                            <span class="text-green-500 mr-2">‚úÖ</span>
                            –ü–µ—Ä—Å–æ–Ω–∞–ª—å–Ω–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞
                        </li>
                        <li class="flex items-center">
                            <span class="text-green-500 mr-2">‚úÖ</span>
                            –ë–µ–ª—ã–π –ª–µ–π–±–ª
                        </li>
                    </ul>
                </div>
            </div>
        </div>

        <!-- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ -->
        <div class="max-w-2xl mx-auto mt-12 text-center">
            <h3 class="text-xl font-semibold text-gray-800 mb-4">–ù—É–∂–Ω–∞ –ø–æ–º–æ—â—å?</h3>
            <p class="text-gray-600 mb-4">–ù–∞—à–∞ –∫–æ–º–∞–Ω–¥–∞ –≥–æ—Ç–æ–≤–∞ –ø–æ–º–æ—á—å –≤–∞–º —Å –ª—é–±—ã–º–∏ –≤–æ–ø—Ä–æ—Å–∞–º–∏</p>
            <div class="flex flex-col sm:flex-row gap-4 justify-center">
                <a href="mailto:support@upworkproposals.ru" class="bg-green-600 hover:bg-green-700 text-white font-semibold py-3 px-6 rounded-lg transition duration-200">
                    üìß –ù–∞–ø–∏—Å–∞—Ç—å –≤ –ø–æ–¥–¥–µ—Ä–∂–∫—É
                </a>
                <a href="https://t.me/upworkproposals" class="bg-blue-500 hover:bg-blue-600 text-white font-semibold py-3 px-6 rounded-lg transition duration-200">
                    üí¨ Telegram —á–∞—Ç
                </a>
            </div>
        </div>
    </div>

    <!-- Supabase SDK -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script>
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Supabase
        const supabaseUrl = 'https://xykhpnksatwipwcmxwyn.supabase.co';
        const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Inh5a2hwbmtzYXR3aXB3Y214d3luIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTUyNTAyNjIsImV4cCI6MjA3MDgyNjI2Mn0.PSARsuv14dI7xq35xvgVoxwjptb4cm8Ywb3bYZhY0KM';
        const supabase = window.supabase.createClient(supabaseUrl, supabaseKey);
    </script>
    <script>
        let currentUser = null;
        
        // API URL –¥–ª—è –ÆKassa (–æ—Ç–∫–ª—é—á–µ–Ω, –∏—Å–ø–æ–ª—å–∑—É–µ–º Supabase)
        // const API_BASE_URL = 'http://localhost:5000/api';

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        document.addEventListener('DOMContentLoaded', function() {
            checkAuthStatus();
            loadSubscriptionData();
        });

        // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏
        function checkAuthStatus() {
            const user = JSON.parse(localStorage.getItem('user'));
            if (user) {
                currentUser = user;
                document.getElementById('userInfo').classList.remove('hidden');
                document.getElementById('userEmail').textContent = user.email;
            } else {
                // –ü–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª—è–µ–º –Ω–∞ –≥–ª–∞–≤–Ω—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É –µ—Å–ª–∏ –Ω–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω
                window.location.href = 'index.html';
            }
        }

        // –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –æ –ø–æ–¥–ø–∏—Å–∫–µ
        async function loadSubscriptionData() {
            if (!currentUser) return;

            try {
                // –ó–∞–≥—Ä—É–∂–∞–µ–º —Ç–µ–∫—É—â—É—é –ø–æ–¥–ø–∏—Å–∫—É –∏–∑ API
                await loadCurrentSubscription();
                
                // –ó–∞–≥—Ä—É–∂–∞–µ–º –∏—Å—Ç–æ—Ä–∏—é –ø–ª–∞—Ç–µ–∂–µ–π –∏–∑ API
                await loadPaymentHistory();
                
                // –ó–∞–≥—Ä—É–∂–∞–µ–º –¥–µ–π—Å—Ç–≤–∏—è —Å –ø–æ–¥–ø–∏—Å–∫–æ–π
                loadSubscriptionActions();
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö:', error);
                // Fallback –∫ –ª–æ–∫–∞–ª—å–Ω—ã–º –¥–∞–Ω–Ω—ã–º
                loadCurrentSubscription();
                loadPaymentHistory();
                loadSubscriptionActions();
            }
        }

        // –ó–∞–≥—Ä—É–∑–∫–∞ —Ç–µ–∫—É—â–µ–π –ø–æ–¥–ø–∏—Å–∫–∏
        async function loadCurrentSubscription() {
            const container = document.getElementById('currentSubscription');
            
            try {
                // –ü—ã—Ç–∞–µ–º—Å—è –ø–æ–ª—É—á–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –∏–∑ Supabase
                const { data, error } = await supabase
                    .from('user_profiles')
                    .select('subscription, daily_remaining')
                    .eq('id', currentUser.id)
                    .single();
                
                if (data && !error && data.subscription && data.subscription !== 'free') {
                    displaySubscriptionFromSupabase(data);
                    return;
                }
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –ø–æ–¥–ø–∏—Å–∫–∏ –∏–∑ Supabase:', error);
            }
            
            // Fallback –∫ –ª–æ–∫–∞–ª—å–Ω—ã–º –¥–∞–Ω–Ω—ã–º
            if (currentUser.subscription && currentUser.subscription !== 'free') {
                const subscriptionInfo = getSubscriptionInfo(currentUser.subscription);
                const isExpired = currentUser.subscriptionExpires && new Date(currentUser.subscriptionExpires) < new Date();
                
                container.innerHTML = `
                    <div class="bg-white rounded-lg shadow-lg p-8">
                        <div class="flex items-center justify-between mb-6">
                            <h2 class="text-2xl font-bold text-gray-800">–¢–µ–∫—É—â–∞—è –ø–æ–¥–ø–∏—Å–∫–∞</h2>
                            <div class="px-4 py-2 rounded-full text-white font-semibold ${isExpired ? 'status-expired' : 'status-active'}">
                                ${isExpired ? '–ò—Å—Ç–µ–∫–ª–∞' : '–ê–∫—Ç–∏–≤–Ω–∞'}
                            </div>
                        </div>
                        
                        <div class="grid md:grid-cols-2 gap-8">
                            <div>
                                <h3 class="text-xl font-semibold text-gray-800 mb-4">${subscriptionInfo.name}</h3>
                                <div class="space-y-3">
                                    <div class="flex justify-between">
                                        <span class="text-gray-600">–¢–∞—Ä–∏—Ñ:</span>
                                        <span class="font-semibold">${subscriptionInfo.name}</span>
                                    </div>
                                    <div class="flex justify-between">
                                        <span class="text-gray-600">AI –ø—Ä–æ–≤–∞–π–¥–µ—Ä:</span>
                                        <span class="font-semibold">${subscriptionInfo.aiProvider}</span>
                                    </div>
                                    <div class="flex justify-between">
                                        <span class="text-gray-600">–î–Ω–µ–≤–Ω–æ–π –ª–∏–º–∏—Ç:</span>
                                        <span class="font-semibold">${subscriptionInfo.dailyLimit === '‚àû' ? '–ë–µ–∑–ª–∏–º–∏—Ç–Ω–æ' : subscriptionInfo.dailyLimit + ' –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–π'}</span>
                                    </div>
                                    <div class="flex justify-between">
                                        <span class="text-gray-600">–°—Ç–æ–∏–º–æ—Å—Ç—å:</span>
                                        <span class="font-semibold">${subscriptionInfo.price}</span>
                                    </div>
                                </div>
                            </div>
                            
                            <div>
                                <h3 class="text-xl font-semibold text-gray-800 mb-4">–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</h3>
                                <div class="space-y-3">
                                    <div class="flex justify-between">
                                        <span class="text-gray-600">–û—Å—Ç–∞–ª–æ—Å—å —Å–µ–≥–æ–¥–Ω—è:</span>
                                        <span class="font-semibold">${currentUser.dailyRemaining === -1 ? '‚àû' : currentUser.dailyRemaining}</span>
                                    </div>
                                    <div class="flex justify-between">
                                        <span class="text-gray-600">–í—Å–µ–≥–æ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–π:</span>
                                        <span class="font-semibold">${currentUser.proposalsCount || 0}</span>
                                    </div>
                                    ${currentUser.subscriptionExpires ? `
                                    <div class="text-xl font-semibold text-gray-800 mb-4">–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</h3>
                                <div class="space-y-3">
                                    <div class="flex justify-between">
                                        <span class="text-gray-600">–û—Å—Ç–∞–ª–æ—Å—å —Å–µ–≥–æ–¥–Ω—è:</span>
                                        <span class="font-semibold">${currentUser.dailyRemaining === -1 ? '‚àû' : currentUser.dailyRemaining}</span>
                                    </div>
                                    <div class="flex justify-between">
                                        <span class="text-gray-600">–í—Å–µ–≥–æ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–π:</span>
                                        <span class="font-semibold">${currentUser.proposalsCount || 0}</span>
                                    </div>
                                    ${currentUser.subscriptionExpires ? `
                                    <div class="flex justify-between">
                                        <span class="text-gray-600">–î–µ–π—Å—Ç–≤—É–µ—Ç –¥–æ:</span>
                                        <span class="font-semibold">${new Date(currentUser.subscriptionExpires).toLocaleDateString('ru-RU')}</span>
                                    </div>
                                    ` : ''}
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            } else {
                container.innerHTML = `
                    <div class="bg-white rounded-lg shadow-lg p-8 text-center">
                        <h2 class="text-2xl font-bold text-gray-800 mb-4">–£ –≤–∞—Å –Ω–µ—Ç –∞–∫—Ç–∏–≤–Ω–æ–π –ø–æ–¥–ø–∏—Å–∫–∏</h2>
                        <p class="text-gray-600 mb-6">–û–±–Ω–æ–≤–∏—Ç–µ—Å—å –¥–æ Premium –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –¥–æ—Å—Ç—É–ø–∞ –∫ —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–º —Ñ—É–Ω–∫—Ü–∏—è–º</p>
                        <a href="index.html" class="bg-blue-600 hover:bg-blue-700 text-white font-semibold py-3 px-6 rounded-lg transition duration-200">
                            üöÄ –û–±–Ω–æ–≤–∏—Ç—å –ø–æ–¥–ø–∏—Å–∫—É
                        </a>
                    </div>
                `;
            }
        }

        // –ó–∞–≥—Ä—É–∑–∫–∞ –∏—Å—Ç–æ—Ä–∏–∏ –ø–ª–∞—Ç–µ–∂–µ–π
        async function loadPaymentHistory() {
            const container = document.getElementById('paymentHistory');
            
            try {
                // –ü—ã—Ç–∞–µ–º—Å—è –ø–æ–ª—É—á–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –∏–∑ Supabase
                const { data, error } = await supabase
                    .from('payment_history')
                    .select('*')
                    .eq('user_id', currentUser.id)
                    .order('created_at', { ascending: false });
                
                if (data && !error && data.length > 0) {
                    displayPaymentHistoryFromSupabase(data);
                    return;
                }
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∏—Å—Ç–æ—Ä–∏–∏ –ø–ª–∞—Ç–µ–∂–µ–π –∏–∑ Supabase:', error);
            }
            
            // Fallback –∫ –ª–æ–∫–∞–ª—å–Ω—ã–º –¥–∞–Ω–Ω—ã–º
            const payments = [
                {
                    id: 'yookassa_001',
                    date: new Date(Date.now() - 30 * 24 * 60 * 60 * 1000),
                    amount: 1500,
                    currency: 'RUB',
                    status: 'succeeded',
                    plan: 'premium'
                }
            ];

            if (payments.length > 0) {
                container.innerHTML = `
                    <div class="bg-white rounded-lg shadow-lg p-8">
                        <h2 class="text-2xl font-bold text-gray-800 mb-6">–ò—Å—Ç–æ—Ä–∏—è –ø–ª–∞—Ç–µ–∂–µ–π</h2>
                        <div class="overflow-x-auto">
                            <table class="w-full">
                                <thead>
                                    <tr class="border-b">
                                        <th class="text-left py-3 px-4">–î–∞—Ç–∞</th>
                                        <th class="text-left py-3 px-4">–ü–ª–∞–Ω</th>
                                        <th class="text-left py-3 px-4">–°—É–º–º–∞</th>
                                        <th class="text-left py-3 px-4">–°—Ç–∞—Ç—É—Å</th>
                                        <th class="text-left py-3 px-4">ID –ø–ª–∞—Ç–µ–∂–∞</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    ${payments.map(payment => `
                                        <tr class="border-b hover:bg-gray-50">
                                            <td class="py-3 px-4">${payment.date.toLocaleDateString('ru-RU')}</td>
                                            <td class="py-3 px-4">
                                                <span class="px-2 py-1 bg-blue-100 text-blue-800 rounded-full text-sm">
                                                    ${payment.plan.toUpperCase()}
                                                </span>
                                            </td>
                                            <td class="py-3 px-4 font-semibold">${payment.amount.toLocaleString()} ${payment.currency}</td>
                                            <td class="py-3 px-4">
                                                <span class="px-2 py-1 bg-green-100 text-green-800 rounded-full text-sm">
                                                    ${payment.status === 'succeeded' ? '–£—Å–ø–µ—à–Ω–æ' : payment.status}
                                                </span>
                                            </td>
                                            <td class="py-3 px-4 text-sm text-gray-500">${payment.id}</td>
                                        </tr>
                                    `).join('')}
                                </tbody>
                            </table>
                        </div>
                    </div>
                `;
            } else {
                container.innerHTML = `
                    <div class="bg-white rounded-lg shadow-lg p-8 text-center">
                        <h2 class="text-2xl font-bold text-gray-800 mb-4">–ò—Å—Ç–æ—Ä–∏—è –ø–ª–∞—Ç–µ–∂–µ–π</h2>
                        <p class="text-gray-600">–£ –≤–∞—Å –ø–æ–∫–∞ –Ω–µ—Ç –ø–ª–∞—Ç–µ–∂–µ–π</p>
                    </div>
                `;
            }
        }
        
        // –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∏—Å—Ç–æ—Ä–∏–∏ –ø–ª–∞—Ç–µ–∂–µ–π –∏–∑ API
        function displayPaymentHistoryFromAPI(payments) {
            const container = document.getElementById('paymentHistory');
            
            if (payments && payments.length > 0) {
                container.innerHTML = `
                    <div class="bg-white rounded-lg shadow-lg p-8">
                        <h2 class="text-2xl font-bold text-gray-800 mb-6">–ò—Å—Ç–æ—Ä–∏—è –ø–ª–∞—Ç–µ–∂–µ–π</h2>
                        <div class="overflow-x-auto">
                            <table class="w-full">
                                <thead>
                                    <tr class="border-b">
                                        <th class="text-left py-3 px-4">–î–∞—Ç–∞</th>
                                        <th class="text-left py-3 px-4">–ü–ª–∞–Ω</th>
                                        <th class="text-left py-3 px-4">–°—É–º–º–∞</th>
                                        <th class="text-left py-3 px-4">–°—Ç–∞—Ç—É—Å</th>
                                        <th class="text-left py-3 px-4">ID –ø–ª–∞—Ç–µ–∂–∞</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    ${payments.map(payment => `
                                        <tr class="border-b hover:bg-gray-50">
                                            <td class="py-3 px-4">${new Date(payment.created_at).toLocaleDateString('ru-RU')}</td>
                                            <td class="py-3 px-4">
                                                <span class="px-2 py-1 bg-blue-100 text-blue-800 rounded-full text-sm">
                                                    ${payment.plan_type.toUpperCase()}
                                                </span>
                                            </td>
                                            <td class="py-3 px-4 font-semibold">${payment.amount.toLocaleString()} ${payment.currency}</td>
                                            <td class="py-3 px-4">
                                                <span class="px-2 py-1 bg-green-100 text-green-800 rounded-full text-sm">
                                                    ${payment.status === 'succeeded' ? '–£—Å–ø–µ—à–Ω–æ' : payment.status}
                                                </span>
                                            </td>
                                            <td class="py-3 px-4 text-sm text-gray-500">${payment.payment_id}</td>
                                        </tr>
                                    `).join('')}
                                </tbody>
                            </table>
                        </div>
                    </div>
                `;
            } else {
                container.innerHTML = `
                    <div class="bg-white rounded-lg shadow-lg p-8 text-center">
                        <h2 class="text-2xl font-bold text-gray-800 mb-4">–ò—Å—Ç–æ—Ä–∏—è –ø–ª–∞—Ç–µ–∂–µ–π</h2>
                        <p class="text-gray-600">–£ –≤–∞—Å –ø–æ–∫–∞ –Ω–µ—Ç –ø–ª–∞—Ç–µ–∂–µ–π</p>
                    </div>
                `;
            }
        }

        // –ó–∞–≥—Ä—É–∑–∫–∞ –¥–µ–π—Å—Ç–≤–∏–π —Å –ø–æ–¥–ø–∏—Å–∫–æ–π
        function loadSubscriptionActions() {
            const container = document.getElementById('subscriptionActions');
            
            if (currentUser.subscription && currentUser.subscription !== 'free') {
                container.innerHTML = `
                    <div class="bg-white rounded-lg shadow-lg p-8">
                        <h2 class="text-2xl font-bold text-gray-800 mb-6">–î–µ–π—Å—Ç–≤–∏—è —Å –ø–æ–¥–ø–∏—Å–∫–æ–π</h2>
                        <div class="grid md:grid-cols-2 gap-6">
                            <div class="space-y-4">
                                <button onclick="renewSubscription()" class="w-full bg-green-600 hover:bg-green-700 text-white font-semibold py-3 px-6 rounded-lg transition duration-200">
                                    üîÑ –ü—Ä–æ–¥–ª–∏—Ç—å –ø–æ–¥–ø–∏—Å–∫—É
                                </button>
                                <button onclick="changePlan()" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-semibold py-3 px-6 rounded-lg transition duration-200">
                                    üîÑ –ò–∑–º–µ–Ω–∏—Ç—å –ø–ª–∞–Ω
                                </button>
                            </div>
                            <div class="space-y-4">
                                <button onclick="pauseSubscription()" class="w-full bg-yellow-600 hover:bg-yellow-700 text-white font-semibold py-3 px-6 rounded-lg transition duration-200">
                                    ‚è∏Ô∏è –ü—Ä–∏–æ—Å—Ç–∞–Ω–æ–≤–∏—Ç—å
                                </button>
                                <button onclick="cancelSubscription()" class="w-full bg-red-600 hover:bg-red-700 text-white font-semibold py-3 px-6 rounded-lg transition duration-200">
                                    ‚ùå –û—Ç–º–µ–Ω–∏—Ç—å –ø–æ–¥–ø–∏—Å–∫—É
                                </button>
                            </div>
                        </div>
                        
                        <div class="mt-6 p-4 bg-yellow-50 border border-yellow-200 rounded-lg">
                            <p class="text-yellow-800 text-sm">
                                ‚ö†Ô∏è <strong>–í–Ω–∏–º–∞–Ω–∏–µ:</strong> –û—Ç–º–µ–Ω–∞ –ø–æ–¥–ø–∏—Å–∫–∏ –≤—Å—Ç—É–ø–∏—Ç –≤ —Å–∏–ª—É –≤ –∫–æ–Ω—Ü–µ —Ç–µ–∫—É—â–µ–≥–æ –ø–µ—Ä–∏–æ–¥–∞. 
                                –í—ã —Å–æ—Ö—Ä–∞–Ω–∏—Ç–µ –¥–æ—Å—Ç—É–ø –¥–æ ${currentUser.subscriptionExpires ? new Date(currentUser.subscriptionExpires).toLocaleDateString('ru-RU') : '–∫–æ–Ω—Ü–∞ –ø–µ—Ä–∏–æ–¥–∞'}.
                            </p>
                        </div>
                    </div>
                `;
            } else {
                container.innerHTML = `
                    <div class="bg-white rounded-lg shadow-lg p-8 text-center">
                        <h2 class="text-2xl font-bold text-gray-800 mb-4">–î–µ–π—Å—Ç–≤–∏—è —Å –ø–æ–¥–ø–∏—Å–∫–æ–π</h2>
                        <p class="text-gray-600 mb-6">–£ –≤–∞—Å –Ω–µ—Ç –∞–∫—Ç–∏–≤–Ω–æ–π –ø–æ–¥–ø–∏—Å–∫–∏ –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è</p>
                        <a href="index.html" class="bg-blue-600 hover:bg-blue-700 text-white font-semibold py-3 px-6 rounded-lg transition duration-200">
                            üöÄ –û—Ñ–æ—Ä–º–∏—Ç—å –ø–æ–¥–ø–∏—Å–∫—É
                        </a>
                    </div>
                `;
            }
        }

        // –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –ø–æ–¥–ø–∏—Å–∫–∏ –∏–∑ Supabase
        function displaySubscriptionFromSupabase(data) {
            const container = document.getElementById('currentSubscription');
            const subscriptionInfo = getSubscriptionInfo(data.subscription);
            
            container.innerHTML = `
                <div class="bg-white rounded-lg shadow-lg p-8">
                    <div class="flex items-center justify-between mb-6">
                        <h2 class="text-2xl font-bold text-gray-800">–¢–µ–∫—É—â–∞—è –ø–æ–¥–ø–∏—Å–∫–∞</h2>
                        <div class="px-4 py-2 rounded-full text-white font-semibold status-active">
                            –ê–∫—Ç–∏–≤–Ω–∞
                        </div>
                    </div>
                    
                    <div class="grid md:grid-cols-2 gap-8">
                        <div>
                            <h3 class="text-xl font-semibold text-gray-800 mb-4">${subscriptionInfo.name}</h3>
                            <div class="space-y-3">
                                <div class="flex justify-between">
                                    <span class="text-gray-600">–¢–∞—Ä–∏—Ñ:</span>
                                    <span class="font-semibold">${subscriptionInfo.name}</span>
                                </div>
                                <div class="flex justify-between">
                                    <span class="text-gray-600">AI –ø—Ä–æ–≤–∞–π–¥–µ—Ä:</span>
                                    <span class="font-semibold">${subscriptionInfo.aiProvider}</span>
                                </div>
                                <div class="flex justify-between">
                                    <span class="text-gray-600">–î–Ω–µ–≤–Ω–æ–π –ª–∏–º–∏—Ç:</span>
                                    <span class="font-semibold">${subscriptionInfo.dailyLimit === '‚àû' ? '–ë–µ–∑–ª–∏–º–∏—Ç–Ω–æ' : subscriptionInfo.dailyLimit + ' –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–π'}</span>
                                </div>
                                <div class="flex justify-between">
                                    <span class="text-gray-600">–°—Ç–æ–∏–º–æ—Å—Ç—å:</span>
                                    <span class="font-semibold">${subscriptionInfo.price}</span>
                                </div>
                            </div>
                        </div>
                        
                        <div>
                            <h3 class="text-xl font-semibold text-gray-800 mb-4">–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</h3>
                            <div class="space-y-3">
                                <div class="flex justify-between">
                                    <span class="text-gray-600">–û—Å—Ç–∞–ª–æ—Å—å —Å–µ–≥–æ–¥–Ω—è:</span>
                                    <span class="font-semibold">${data.daily_remaining || subscriptionInfo.dailyLimit}</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        // –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∏—Å—Ç–æ—Ä–∏–∏ –ø–ª–∞—Ç–µ–∂–µ–π –∏–∑ Supabase
        function displayPaymentHistoryFromSupabase(payments) {
            const container = document.getElementById('paymentHistory');
            
            if (payments && payments.length > 0) {
                container.innerHTML = `
                    <div class="bg-white rounded-lg shadow-lg p-8">
                        <h2 class="text-2xl font-bold text-gray-800 mb-6">–ò—Å—Ç–æ—Ä–∏—è –ø–ª–∞—Ç–µ–∂–µ–π</h2>
                        <div class="space-y-4">
                            ${payments.map(payment => `
                                <div class="flex items-center justify-between p-4 bg-gray-50 rounded-lg">
                                    <div>
                                        <div class="font-semibold text-gray-800">${payment.plan_type || 'Premium'}</div>
                                        <div class="text-sm text-gray-600">${new Date(payment.created_at).toLocaleDateString('ru-RU')}</div>
                                    </div>
                                    <div class="text-right">
                                        <div class="font-semibold text-gray-800">${payment.amount || 1500} ‚ÇΩ</div>
                                        <div class="text-sm text-green-600">–û–ø–ª–∞—á–µ–Ω</div>
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                `;
            } else {
                container.innerHTML = `
                    <div class="bg-white rounded-lg shadow-lg p-8 text-center">
                        <h2 class="text-2xl font-bold text-gray-800 mb-4">–ò—Å—Ç–æ—Ä–∏—è –ø–ª–∞—Ç–µ–∂–µ–π</h2>
                        <p class="text-gray-600">–£ –≤–∞—Å –ø–æ–∫–∞ –Ω–µ—Ç –ø–ª–∞—Ç–µ–∂–µ–π</p>
                    </div>
                `;
            }
        }

        // –ü–æ–ª—É—á–∏—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –ø–æ–¥–ø–∏—Å–∫–µ
        function getSubscriptionInfo(subscriptionType) {
            const subscriptionData = {
                'free': {
                    name: '–ë–µ—Å–ø–ª–∞—Ç–Ω–∞—è',
                    aiProvider: '–î–µ–º–æ-—Ä–µ–∂–∏–º',
                    dailyLimit: 3,
                    price: '0 ‚ÇΩ'
                },
                'premium': {
                    name: 'Premium',
                    aiProvider: 'Yandex GPT',
                    dailyLimit: 50,
                    price: '1,500 ‚ÇΩ'
                },
                'pro': {
                    name: 'Pro',
                    aiProvider: 'Yandex GPT + GigaChat',
                    dailyLimit: 200,
                    price: '3,000 ‚ÇΩ'
                },
                'enterprise': {
                    name: 'Enterprise',
                    aiProvider: '–í—Å–µ AI –ø—Ä–æ–≤–∞–π–¥–µ—Ä—ã',
                    dailyLimit: '‚àû',
                    price: '9,900 ‚ÇΩ'
                }
            };
            
            return subscriptionData[subscriptionType] || subscriptionData['free'];
        }

        // –î–µ–π—Å—Ç–≤–∏—è —Å –ø–æ–¥–ø–∏—Å–∫–æ–π
        function renewSubscription() {
            alert('–§—É–Ω–∫—Ü–∏—è –ø—Ä–æ–¥–ª–µ–Ω–∏—è –ø–æ–¥–ø–∏—Å–∫–∏ –±—É–¥–µ—Ç –¥–æ—Å—Ç—É–ø–Ω–∞ –≤ –±–ª–∏–∂–∞–π—à–µ–µ –≤—Ä–µ–º—è');
        }

        function changePlan() {
            alert('–§—É–Ω–∫—Ü–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏—è –ø–ª–∞–Ω–∞ –±—É–¥–µ—Ç –¥–æ—Å—Ç—É–ø–Ω–∞ –≤ –±–ª–∏–∂–∞–π—à–µ–µ –≤—Ä–µ–º—è');
        }

        function pauseSubscription() {
            alert('–§—É–Ω–∫—Ü–∏—è –ø—Ä–∏–æ—Å—Ç–∞–Ω–æ–≤–∫–∏ –ø–æ–¥–ø–∏—Å–∫–∏ –±—É–¥–µ—Ç –¥–æ—Å—Ç—É–ø–Ω–∞ –≤ –±–ª–∏–∂–∞–π—à–µ–µ –≤—Ä–µ–º—è');
        }

        function cancelSubscription() {
            if (confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ –æ—Ç–º–µ–Ω–∏—Ç—å –ø–æ–¥–ø–∏—Å–∫—É? –≠—Ç–æ –¥–µ–π—Å—Ç–≤–∏–µ –Ω–µ–ª—å–∑—è –æ—Ç–º–µ–Ω–∏—Ç—å.')) {
                // –ò–º–∏—Ç–∞—Ü–∏—è –æ—Ç–º–µ–Ω—ã –ø–æ–¥–ø–∏—Å–∫–∏
                currentUser.subscription = 'free';
                currentUser.dailyRemaining = 3;
                currentUser.subscriptionExpires = null;
                
                // –û–±–Ω–æ–≤–ª—è–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
                const users = JSON.parse(localStorage.getItem('users') || '[]');
                const userIndex = users.findIndex(u => u.email === currentUser.email);
                if (userIndex !== -1) {
                    users[userIndex] = currentUser;
                    localStorage.setItem('users', JSON.stringify(users));
                }
                
                localStorage.setItem('user', JSON.stringify(currentUser));
                
                // –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ
                loadSubscriptionData();
                
                alert('–ü–æ–¥–ø–∏—Å–∫–∞ –æ—Ç–º–µ–Ω–µ–Ω–∞. –í—ã –≤–µ—Ä–Ω—É–ª–∏—Å—å –Ω–∞ –±–µ—Å–ø–ª–∞—Ç–Ω—ã–π –ø–ª–∞–Ω.');
            }
        }

        function logout() {
            localStorage.removeItem('user');
            window.location.href = 'index.html';
        }
    </script>
</body>
</html>