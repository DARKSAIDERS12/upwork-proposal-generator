<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ë—ã—Å—Ç—Ä—ã–π —Ç–µ—Å—Ç –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 600px;
            margin: 50px auto;
            padding: 20px;
            background: #f0f2f5;
        }
        .test-box {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            text-align: center;
        }
        .status {
            padding: 15px;
            margin: 20px 0;
            border-radius: 8px;
            font-weight: bold;
            font-size: 16px;
        }
        .success { background: #d4edda; color: #155724; }
        .error { background: #f8d7da; color: #721c24; }
        .info { background: #d1ecf1; color: #0c5460; }
        .loading { background: #fff3cd; color: #856404; }
        button {
            background: #007bff;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 6px;
            cursor: pointer;
            margin: 10px;
            font-size: 16px;
        }
        button:hover { background: #0056b3; }
        button:disabled { background: #6c757d; cursor: not-allowed; }
        .spinner {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid #007bff;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-right: 10px;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <div class="test-box">
        <h1>üîê –ë—ã—Å—Ç—Ä—ã–π —Ç–µ—Å—Ç –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏</h1>
        <p>–≠—Ç–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –ø—Ä–æ–≤–µ—Ä–∏—Ç, —Ä–∞–±–æ—Ç–∞–µ—Ç –ª–∏ —Å–∏—Å—Ç–µ–º–∞ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏</p>
        
        <div id="status" class="status info">
            <span class="spinner"></span>
            –ó–∞–≥—Ä—É–∂–∞–µ–º...
        </div>
        
        <button onclick="runTest()" id="testBtn">–ó–∞–ø—É—Å—Ç–∏—Ç—å —Ç–µ—Å—Ç</button>
        <button onclick="checkAuth()" id="authBtn" disabled>–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—é</button>
        
        <div id="result"></div>
    </div>

    <!-- Supabase SDK -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    
    <!-- Auth.js -->
    <script src="auth.js"></script>
    
    <script>
        let testStep = 0;
        const totalSteps = 4;
        
        function updateStatus(message, type = 'info') {
            const status = document.getElementById('status');
            status.className = `status ${type}`;
            status.innerHTML = message;
        }
        
        function updateProgress() {
            testStep++;
            const percentage = Math.round((testStep / totalSteps) * 100);
            console.log(`–ü—Ä–æ–≥—Ä–µ—Å—Å: ${percentage}%`);
        }
        
        async function runTest() {
            testStep = 0;
            const testBtn = document.getElementById('testBtn');
            const authBtn = document.getElementById('authBtn');
            
            testBtn.disabled = true;
            updateStatus('üîÑ –ó–∞–ø—É—Å–∫–∞–µ–º —Ç–µ—Å—Ç...', 'loading');
            
            try {
                // –®–∞–≥ 1: –ü—Ä–æ–≤–µ—Ä–∫–∞ Supabase SDK
                updateStatus('üîç –ü—Ä–æ–≤–µ—Ä—è–µ–º Supabase SDK...', 'loading');
                await new Promise(resolve => setTimeout(resolve, 1000));
                
                if (typeof createClient === 'undefined') {
                    throw new Error('Supabase SDK –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω');
                }
                updateStatus('‚úÖ Supabase SDK –∑–∞–≥—Ä—É–∂–µ–Ω', 'success');
                updateProgress();
                
                // –®–∞–≥ 2: –ü—Ä–æ–≤–µ—Ä–∫–∞ auth.js
                updateStatus('üîç –ü—Ä–æ–≤–µ—Ä—è–µ–º auth.js...', 'loading');
                await new Promise(resolve => setTimeout(resolve, 1000));
                
                if (typeof registerUser === 'undefined' || typeof loginUser === 'undefined') {
                    throw new Error('–§—É–Ω–∫—Ü–∏–∏ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω—ã');
                }
                updateStatus('‚úÖ auth.js –∑–∞–≥—Ä—É–∂–µ–Ω', 'success');
                updateProgress();
                
                // –®–∞–≥ 3: –ü—Ä–æ–≤–µ—Ä–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏
                updateStatus('üîç –ü—Ä–æ–≤–µ—Ä—è–µ–º –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—é...', 'loading');
                await new Promise(resolve => setTimeout(resolve, 1000));
                
                if (typeof supabase === 'undefined' || supabase === null) {
                    throw new Error('Supabase –Ω–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω');
                }
                updateStatus('‚úÖ Supabase –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω', 'success');
                updateProgress();
                
                // –®–∞–≥ 4: –§–∏–Ω–∞–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞
                updateStatus('üîç –§–∏–Ω–∞–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞...', 'loading');
                await new Promise(resolve => setTimeout(resolve, 1000));
                
                updateStatus('üéâ –í—Å–µ —Ç–µ—Å—Ç—ã –ø—Ä–æ–π–¥–µ–Ω—ã —É—Å–ø–µ—à–Ω–æ!', 'success');
                updateProgress();
                
                // –ê–∫—Ç–∏–≤–∏—Ä—É–µ–º –∫–Ω–æ–ø–∫—É –ø—Ä–æ–≤–µ—Ä–∫–∏ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏
                authBtn.disabled = false;
                
            } catch (error) {
                console.error('‚ùå –û—à–∏–±–∫–∞ —Ç–µ—Å—Ç–∞:', error);
                updateStatus(`‚ùå –û—à–∏–±–∫–∞: ${error.message}`, 'error');
            } finally {
                testBtn.disabled = false;
            }
        }
        
        async function checkAuth() {
            const result = document.getElementById('result');
            result.innerHTML = '<div class="status loading">üîÑ –ü—Ä–æ–≤–µ—Ä—è–µ–º –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—é...</div>';
            
            try {
                if (typeof getCurrentUser === 'undefined') {
                    throw new Error('–§—É–Ω–∫—Ü–∏—è getCurrentUser –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞');
                }
                
                const user = await getCurrentUser();
                if (user) {
                    result.innerHTML = `<div class="status success">‚úÖ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω: ${user.email}</div>`;
                } else {
                    result.innerHTML = '<div class="status info">üë§ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω</div>';
                }
            } catch (error) {
                result.innerHTML = `<div class="status error">‚ùå –û—à–∏–±–∫–∞: ${error.message}</div>`;
            }
        }
        
        // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –∑–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        window.addEventListener('load', function() {
            setTimeout(runTest, 1000);
        });
    </script>
</body>
</html>
